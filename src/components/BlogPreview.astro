---
import {Picture} from '@astrojs/image/components';
import type {PostInstance} from '$types';
import {getLongDateString} from '$utils';
import config from '$config';

export interface Props {
  posts: (PostInstance & {
    frontmatter: {heroImageMetadata: ImageMetadata};
  })[];
}

const {posts} = Astro.props as Props;
/*
	build buf fix
	https://github.com/withastro/astro/issues/3373 
 */
const images = import.meta.glob<ImageMetadata>('../assets/blog/**/*', {import: 'default'});
for (let i = 0; i < posts.length; i++) {
  const heroImage = posts[i].frontmatter?.heroImage;
  if (heroImage) posts[i].frontmatter.heroImageMetadata = await images[heroImage]();
}
---

<div class='flex flex-col gap-2 divide-y'>
  {
    posts.map(post => (
      <section class='py-11 flex flex-col'>
        {/* Hero Image */}
        {post.frontmatter.heroImage && (
          <a href={post.url}>
            <div class='mb-4 w-full h-56 overflow-hidden flex items-center justify-center bg-gray-100'>
              <Picture
                src={post.frontmatter.heroImageMetadata.src}
                aspectRatio={
                  post.frontmatter.heroImageMetadata.width /
                  post.frontmatter.heroImageMetadata.height
                }
                alt='Hero'
                sizes=''
                widths={[400, 800, 1200]}
                formats={['webp']}
              />
            </div>
          </a>
        )}
        {/* Title */}
        <h2 class='mb-2 text-3xl font-bold line-clamp-3'>
          <a href={post.url}>{post.frontmatter.title}</a>
        </h2>
        {/* Description */}
        <p class='mb-4 text-gray-600 tracking-tight line-clamp-2'>{post.frontmatter.description}</p>
        {/* Tags */}
        {post.frontmatter.tags && (
          <ul class='mb-4 flex flex-row gap-1.5 flex-wrap'>
            {post.frontmatter.tags?.map(tag => (
              <li class='rounded-full bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 text-sm leading-none tracking-tight'>
                <a class='block px-2.5 py-1.5' href={`/tag/${tag}`}>
                  {tag}
                </a>
              </li>
            ))}
          </ul>
        )}
        {/* Published Date */}
        <div class='flex flex-row text-gray-500 text-sm'>
          <time datetime={post.frontmatter.publishDate}>
            {getLongDateString(config.locale, new Date(post.frontmatter.publishDate))}
          </time>
          <div class='px-2'>Â·</div>
          <span>{post.frontmatter.minutesRead}</span>
        </div>
      </section>
    ))
  }
</div>

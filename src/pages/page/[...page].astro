---
import type {GetStaticPathsOptions} from 'astro';
import BlogPostPreview from '$coms/PostPreview.astro';
import Pagination from '$coms/Pagination.astro';
import config from '$config';
import MainLayout from '$lays/MainLayout.astro';
import BlogPreview from '$coms/BlogPreview.astro';

export async function getStaticPaths({paginate}: GetStaticPathsOptions) {
  const allPosts = await Astro.glob('../p/**/*.{md,mdx}');
  const sortedPosts = allPosts.sort(
    (a, b) =>
      new Date(b.frontmatter.publishDate).getTime() - new Date(a.frontmatter.publishDate).getTime(),
  );
  // Return a paginated collection of paths for all posts
  return paginate(sortedPosts, {pageSize: 7});
}

const {page} = Astro.props;
const canonicalURL = Astro.url.toString();

const props = {
  wide: false,
  seo: {
    title: 'Blog',
    description: 'Blog page',
    canonical: canonicalURL,
  },
  NavigationItems: {
    blog: {enabled: false, expanded: true},
    home: {enabled: true, expanded: false},
    portfolio: {enabled: true, expanded: false},
    rss: {enabled: false, expanded: false},
    search: {enabled: true, expanded: false},
    series: {enabled: true, expanded: true},
    theme: {enabled: true, expanded: true},
  },
};
---

<MainLayout
  config={config}
  seo={props.seo}
  NavigationItems={props.NavigationItems}
  wide={props.wide}
>
  <main class='w-full'>
    {/* Hero */}
    <div class='pt-[88px] flex flex-col'>
      <div class='max-w-3xl w-full mx-auto px-5 pt-8 pb-24'>
        <span class='text-lg text-gray-600'></span>
        <h1 class='text-6xl font-bold leading-relaxed'>All Posts</h1>
        <h2 class='text-2xl leading-normal text-gray-600'>
          {page.start + 1}â€“{page.end + 1} of {page.total}
        </h2>
      </div>
    </div>
    <div class='max-w-3xl w-full mx-auto px-5 py-4'>
      <BlogPreview posts={page.data} />

      <Pagination prevUrl={page.url.prev} nextUrl={page.url.next} />
    </div>
  </main>
</MainLayout>
